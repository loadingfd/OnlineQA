import{Z as e,a as t,z as s,n as a,r as l,c as i,w as n,l as c,o,b as r,d,t as u,q as h,e as m,f,F as g,k as _,a0 as p,B as b,O as k,m as D,M as C}from"./index-nnZW9WDd.js";import{_ as y}from"./uni-list-item.Dt_Is--a.js";import{r as I}from"./uni-app.es.YMhB4L0_.js";import{_ as $}from"./uni-list.BPGN9fmt.js";import{_ as w}from"./uni-load-more.CaYHO8__.js";import{_ as j}from"./unicloud-db.CMy1RrDf.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.BTZacCfd.js";const q=e.database();const v=x({data:()=>({startDate:"",endDate:"",dbWhere:"",field:"title,time,descrip,is_stick,user_id{nickname}, states",currentUser:null,selectedItems:[]}),methods:{onStartDateChange(e){this.startDate=e.detail.value},onEndDateChange(e){this.endDate=e.detail.value},applyFilter(){const e=new Date(this.startDate).getTime(),t=new Date(this.endDate).getTime()+864e5;this.endDate?this.startDate?this.dbWhere=`time >= ${e} && time < ${t}`:this.dbWhere=`time < ${t}`:this.dbWhere=`time >= ${e}`,console.log(this.dbWhere)},checkboxGroupChange(e){this.selectedItems=e.detail.value},async batchDelete(){0!==this.selectedItems.length?s({title:"确认删除",content:`确定要删除选中的 ${this.selectedItems.length} 个帖子吗？`,success:async e=>{if(e.confirm)try{const e=this.selectedItems.map((e=>q.collection("questions").doc(e).update({states:!1})));await Promise.all(e),t({title:"删除成功",icon:"success"}),this.selectedItems=[],this.$refs.udb.refresh()}catch(s){t({title:"删除失败",icon:"error"}),console.error("批量删除失败:",s)}}}):t({title:"请选择要删除的项目",icon:"none"})},handleItemClick(e){0===this.selectedItems.length&&a({url:"/pages/questions/detail?id="+e})},async batchRestore(){0!==this.selectedItems.length?s({title:"确认恢复",content:`确定要恢复选中的 ${this.selectedItems.length} 个帖子吗？`,success:async e=>{if(e.confirm)try{const e=this.selectedItems.map((e=>q.collection("questions").doc(e).update({states:!0})));await Promise.all(e),t({title:"恢复成功",icon:"success"}),this.selectedItems=[],this.$refs.udb.refresh()}catch(s){t({title:"恢复失败",icon:"error"}),console.error("批量恢复失败:",s)}}}):t({title:"请选择要恢复的项目",icon:"none"})},timeToDate(e){const t=new Date(e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`}}},[["render",function(e,t,s,a,x,q){const v=_,S=c,W=p,F=b,M=C,T=I(l("uni-list-item"),y),z=k,G=I(l("uni-list"),$),E=I(l("uni-load-more"),w),P=I(l("unicloud-db"),j);return o(),i(S,{class:"admin-center"},{default:n((()=>[r(S,{class:"header"},{default:n((()=>[r(v,{class:"header-title"},{default:n((()=>[d("管理者模式")])),_:1})])),_:1}),r(S,{class:"filter-section"},{default:n((()=>[r(W,{mode:"date",onChange:q.onStartDateChange},{default:n((()=>[r(S,{class:"picker"},{default:n((()=>[d(" 开始日期: "+u(x.startDate||"请选择"),1)])),_:1})])),_:1},8,["onChange"]),r(W,{mode:"date",onChange:q.onEndDateChange},{default:n((()=>[r(S,{class:"picker"},{default:n((()=>[d(" 结束日期: "+u(x.endDate||"请选择"),1)])),_:1})])),_:1},8,["onChange"]),r(F,{class:"filter-btn",onClick:q.applyFilter},{default:n((()=>[d("筛选")])),_:1},8,["onClick"])])),_:1}),x.selectedItems.length>0?(o(),i(S,{key:0,class:"batch-actions"},{default:n((()=>[r(F,{class:"batch-delete-btn",onClick:q.batchDelete},{default:n((()=>[d(" 批量删除("+u(x.selectedItems.length)+") ",1)])),_:1},8,["onClick"]),r(F,{class:"batch-restore-btn",onClick:q.batchRestore},{default:n((()=>[d(" 批量恢复("+u(x.selectedItems.length)+") ",1)])),_:1},8,["onClick"])])),_:1})):h("",!0),r(P,{ref:"udb",collection:"questions",where:x.dbWhere,field:x.field,getone:!1,getcount:!0,orderby:"states desc,is_stick desc,time desc"},{default:n((({data:e,loading:t,hasMore:s,error:a})=>[a?(o(),i(S,{key:0,class:"error-message"},{default:n((()=>[d(u(a.message),1)])),_:2},1024)):(o(),i(S,{key:1},{default:n((()=>[e&&e.length?(o(),i(G,{key:0,class:"question-list"},{default:n((()=>[r(z,{onChange:q.checkboxGroupChange},{default:n((()=>[(o(!0),m(g,null,f(e,((e,t)=>(o(),i(T,{key:e._id,clickable:!0,onClick:t=>q.handleItemClick(e._id),class:"list-item"},{header:n((()=>[r(S,{class:"item-header"},{default:n((()=>[r(M,{value:e._id,checked:x.selectedItems.includes(e._id)},null,8,["value","checked"]),r(S,{class:"user-info"},{default:n((()=>[r(v,{class:"nickname"},{default:n((()=>[d(u(e.user_id.nickname),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),body:n((()=>[r(S,{class:"question-content"},{default:n((()=>[r(S,{class:"title-container"},{default:n((()=>[r(v,{class:"title",style:D({color:e.states?"#333":"red",textDecoration:e.states?"none":"line-through"})},{default:n((()=>[d(u(e.title.length>15?e.title.substring(0,15)+"...":e.title),1)])),_:2},1032,["style"])])),_:2},1024),r(S,{class:"description"},{default:n((()=>[d(u(e.descrip.substring(0,100))+u(e.descrip.length>100?"...":""),1)])),_:2},1024)])),_:2},1024),r(S,{style:{"font-size":"16rpx",color:"#999","text-align":"right"}},{default:n((()=>[d(u(q.timeToDate(e.time)),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:2},1032,["onChange"])])),_:2},1024)):t?h("",!0):(o(),i(S,{key:1,class:"error-message"},{default:n((()=>[d("暂无数据")])),_:1}))])),_:2},1024)),r(E,{class:"load-more",status:t?"loading":s?"more":"noMore"},null,8,["status"])])),_:1},8,["where","field"])])),_:1})}],["__scopeId","data-v-6ba0e5de"]]);export{v as default};
