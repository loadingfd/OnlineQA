import{Z as e,s as a,h as t,a as l,y as o,z as i,r as s,c as r,w as m,l as n,o as u,b as d,d as c,L as f,B as p}from"./index-nnZW9WDd.js";import{_ as h}from"./uni-easyinput.o8bItaYz.js";import{r as _}from"./uni-app.es.YMhB4L0_.js";import{_ as g}from"./uni-forms-item.CBR7qWz9.js";import{v as y,_ as D}from"./questions.CwRmQra4.js";import{_ as b}from"./uni-file-picker.xRZRjom7.js";import{_ as k}from"./uni-forms.Ds0BSXHg.js";import{_ as V}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.BTZacCfd.js";import"./uni-load-more.CaYHO8__.js";const v=e.database();function x(e){let a={};for(let t in y)e.indexOf(t)>-1&&(a[t]=y[t]);return a}const j=V({data(){let e={title:"",descrip:"",difficulties:null,category:"",images:[],is_stick:null};return{formData:e,formOptions:{difficulties_localdata:[{text:"简单",value:0},{text:"中等",value:1},{text:"困难",value:2}],category_localdata:[{text:"数学题",value:"math"},{text:"编程题",value:"code"},{text:"求资料",value:"resource"},{text:"其他",value:"other"}]},rules:{...x(Object.keys(e))}}},onLoad(e){if(e.id){const a=e.id;this.formDataId=a,this.getDetail(a)}},onReady(){this.$refs.form.setRules(this.rules)},methods:{submit(){a({mask:!0}),this.$refs.form.validate().then((e=>this.submitForm(e))).catch((()=>{})).finally((()=>{t()}))},submitForm(e){return v.collection("questions").doc(this.formDataId).update(e).then((e=>{l({icon:"none",title:"修改成功"}),this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>o()),500)})).catch((e=>{i({content:e.message||"请求服务失败",showCancel:!1})}))},getDetail(e){a({mask:!0}),v.collection("questions").doc(e).field("title,descrip,difficulties,category,images,is_stick").get().then((e=>{const a=e.result.data[0];a&&(this.formData=a)})).catch((e=>{i({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{t()}))}}},[["render",function(e,a,t,l,o,i){const y=_(s("uni-easyinput"),h),V=_(s("uni-forms-item"),g),v=_(s("uni-data-checkbox"),D),x=_(s("uni-file-picker"),b),j=f,C=p,O=n,w=_(s("uni-forms"),k);return u(),r(O,{class:"uni-container"},{default:m((()=>[d(w,{ref:"form",model:o.formData,"validate-trigger":"submit","err-show-type":"toast"},{default:m((()=>[d(V,{name:"title",label:"标题"},{default:m((()=>[d(y,{placeholder:"标题",modelValue:o.formData.title,"onUpdate:modelValue":a[0]||(a[0]=e=>o.formData.title=e)},null,8,["modelValue"])])),_:1}),d(V,{name:"descrip",label:"详情"},{default:m((()=>[d(y,{placeholder:"描述你的问题",modelValue:o.formData.descrip,"onUpdate:modelValue":a[1]||(a[1]=e=>o.formData.descrip=e)},null,8,["modelValue"])])),_:1}),d(V,{name:"difficulties",label:"难度"},{default:m((()=>[d(v,{modelValue:o.formData.difficulties,"onUpdate:modelValue":a[2]||(a[2]=e=>o.formData.difficulties=e),localdata:o.formOptions.difficulties_localdata},null,8,["modelValue","localdata"])])),_:1}),d(V,{name:"category",label:"类型"},{default:m((()=>[d(v,{modelValue:o.formData.category,"onUpdate:modelValue":a[3]||(a[3]=e=>o.formData.category=e),localdata:o.formOptions.category_localdata},null,8,["modelValue","localdata"])])),_:1}),d(V,{name:"images",label:"添加照片"},{default:m((()=>[d(x,{"file-mediatype":"image","file-extname":"jpg,png",limit:3,"return-type":"array",modelValue:o.formData.images,"onUpdate:modelValue":a[4]||(a[4]=e=>o.formData.images=e)},null,8,["modelValue"])])),_:1}),d(V,{name:"is_stick",label:"置顶"},{default:m((()=>[d(j,{onChange:a[5]||(a[5]=a=>e.binddata("is_stick",a.detail.value)),checked:o.formData.is_stick},null,8,["checked"])])),_:1}),d(O,{class:"uni-button-group"},{default:m((()=>[d(C,{type:"primary",class:"uni-button",onClick:i.submit},{default:m((()=>[c("提交")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])),_:1})}],["__scopeId","data-v-2253de07"]]);export{j as default};
